<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Cliente</title>
</head>

<body>
    <!-- Listar Clientes Contidos no Banco de Dados -->
    <center>
        <h1>Lista de Clientes</h1>
    </center>

    <ul id="listaCliente"></ul>

    <!-- Cadastrar Clientes no Banco de Dados -->
    <center>
        <h1>Cadastrar Cliente</h1>
    </center>

    <form action="JavaScript: cadastrar()">
        <div>
            <label for="nome">Nome:</label>
            <input type="text" id="nome">
        </div>
        <div>
            <label for="genero">Gênero:</label> <br>
            <input type="radio" name="genero" value="Feminino">
            <label for="Feminino">Feminino</label> <br>
            <input type="radio" name="genero" value="Masculino">
            <label for="Masculino">Masculino</label>
        </div>
        <div>
            <label for="celular">Nº Celular:</label>
            <input type="text" id="celular">
        </div> <br>
        <button type="submit">Cadastrar Cliente</button>
    </form>

    <!-- Deletar Cliente do Banco de Dados -->
    <center>
        <h1>Deletar Cliente</h1>
    </center>

    <form action="JavaScript: deletar()">
        <div>
            <label for="idCliente">ID do Cliente a ser deletado:</label>
            <input type="text" id="idCliente">
        </div>
        <button type="submit">Deletar Cliente</button>
    </form>

    <!-- Atualizar Nº do Celular do Cliente -->
    <center>
        <h1>Atualizar Nº do Celular do Cliente</h1>
    </center>

    <form action="JavaScript: atualizarNumero()">
        <div>
            <label for="id_cliente">ID do Clinte:</label>
            <input type="text" id="id_cliente">
        </div>
        <br>
        <div>
            <label for="numero">Novo número do celular:</label>
            <input type="text" id="novo_numero">
        </div>
        <button type="submit">Alterar</button>
    </form>

    <script>
        fetch('http://localhost:3000/getDataCliente')
            .then(response => response.json())
            .then(data => {
                const listaCliente = document.getElementById('listaCliente');
                data.forEach(row => {
                    const listItem = document.createElement('li');
                    listItem.textContent = JSON.stringify(row);
                    listaCliente.appendChild(listItem);
                })
            })
            .catch(error => {
                console.error('Error ao obter dados da tabela:', error);
            })

        function cadastrar() {
            var nome = document.getElementById("nome").value;
            var genero = document.querySelector('input[name="genero"]:checked');
            var celular = document.getElementById("celular").value;

            if (nome == '') {
                alert('Informe o nome do cliente.');
                document.getElementById("nome").focus();
            } else if (genero == null) {
                alert('Informe o gênero do cliente.');
            } else if (celular == '') {
                alert('Informe o número do cliente.');
                document.getElementById("celular").focus();
            } else {
                genero = genero.value;

                var data = {
                    nome: nome,
                    genero: genero,
                    celular: celular
                };

                fetch('http://localhost:3000/cadastrar_cliente', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Resposta:', data);
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                    });
                alert('Cliente Cadastrado.');
                location.reload();
            }
        }
        
        function deletar() {
            const idCliente = document.getElementById('idCliente').value;

            fetch(`http://localhost:3000/deletar_cliente/${idCliente}`, {
                method: 'DELETE',
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message);
                })
                .catch(error => {
                    console.error('Erro ao deletar cliente:', error);
                });
            
            alert('Cliente Deletado.');
            location.reload();
        }

        function atualizarNumero() {
            const idCliente = document.getElementById('id_cliente').value;
            const novo_numero = document.getElementById('novo_numero').value;

            fetch(`http://localhost:3000/atualizar_cliente/${idCliente}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    novo_numero: novo_numero,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message);
                })
                .catch(error => {
                    console.error('Erro ao atualizar cliente:', error);
                });
            
            alert('Número alterado.');
            location.reload();
        }
    </script>
</body>

</html>